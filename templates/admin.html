{% extends "base.html" %}

{% block title %}Admin Panel - UET Library{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <!-- Sidebar Navigation -->
    <div class="admin-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-alt"></i>
            <h3>Admin Panel</h3>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" class="sidebar-link active" data-section="overview" onclick="showSection('overview')">
                <i class="fas fa-chart-line"></i>
                <span>Overview</span>
            </a>
            <a href="#" class="sidebar-link" data-section="add-book" onclick="showSection('add-book')">
                <i class="fas fa-book-medical"></i>
                <span>Add Book</span>
            </a>
            <a href="#" class="sidebar-link" data-section="manage-books" onclick="showSection('manage-books')">
                <i class="fas fa-books"></i>
                <span>Manage Books</span>
            </a>
            <a href="#" class="sidebar-link" data-section="add-member" onclick="showSection('add-member')">
                <i class="fas fa-user-plus"></i>
                <span>Add Member</span>
            </a>
            <a href="#" class="sidebar-link" data-section="manage-members" onclick="showSection('manage-members')">
                <i class="fas fa-users-cog"></i>
                <span>Manage Members</span>
            </a>
        </nav>
    </div>
    
    <!-- Main Content Area -->
    <div class="admin-main">
        <!-- Overview Section -->
        <div id="overview-section" class="admin-section active">
            <div class="section-header">
                <h1>
                    <i class="fas fa-chart-line"></i>
                    Library Overview
                </h1>
                <p>Monitor your library statistics and performance</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalBooks">0</h3>
                        <p>Total Books</p>
                        <span class="stat-change positive"><i class="fas fa-arrow-up"></i> Active</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="availableBooks">0</h3>
                        <p>Available Books</p>
                        <span class="stat-change positive"><i class="fas fa-check"></i> Ready</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);">
                        <i class="fas fa-book-reader"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="borrowedBooks">0</h3>
                        <p>Borrowed Books</p>
                        <span class="stat-change"><i class="fas fa-clock"></i> In Use</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalMembers">0</h3>
                        <p>Total Members</p>
                        <span class="stat-change positive"><i class="fas fa-user-check"></i> Active</span>
                    </div>
                </div>
            </div>
            
            <!-- Category Distribution -->
            <div class="overview-cards">
                <div class="overview-card">
                    <h3><i class="fas fa-layer-group"></i> Books by Category</h3>
                    <div id="categoryStats" class="category-stats">
                        <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
                    </div>
                </div>
                
                <div class="overview-card">
                    <h3><i class="fas fa-star"></i> Quick Actions</h3>
                    <div class="quick-actions">
                        <button class="quick-action-btn" onclick="showSection('add-book')">
                            <i class="fas fa-plus"></i>
                            Add New Book
                        </button>
                        <button class="quick-action-btn" onclick="showSection('add-member')">
                            <i class="fas fa-user-plus"></i>
                            Register Member
                        </button>
                        <button class="quick-action-btn" onclick="loadStats()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh Stats
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Add Book Section -->
        <div id="add-book-section" class="admin-section">
            <div class="section-header">
                <h1>
                    <i class="fas fa-book-medical"></i>
                    Add New Book
                </h1>
                <p>Add a new book to the library collection</p>
            </div>
            
            <div class="form-container">
                <form id="addBookForm" class="admin-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="isbn">
                                <i class="fas fa-barcode"></i>
                                ISBN Number
                            </label>
                            <input type="text" id="isbn" placeholder="978-0-13-409341-3" required>
                            <small>International Standard Book Number</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="title">
                                <i class="fas fa-heading"></i>
                                Book Title
                            </label>
                            <input type="text" id="title" placeholder="Enter book title" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="author">
                                <i class="fas fa-user-edit"></i>
                                Author Name
                            </label>
                            <input type="text" id="author" placeholder="Enter author name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="year">
                                <i class="fas fa-calendar-alt"></i>
                                Publication Year
                            </label>
                            <input type="number" id="year" placeholder="2024" min="1800" max="2100" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="category">
                                <i class="fas fa-tag"></i>
                                Category
                            </label>
                            <select id="category" required>
                                <option value="">Select a category</option>
                                <option value="Novel">üìñ Novel</option>
                                <option value="Programming">üíª Programming</option>
                                <option value="Engineering">‚öôÔ∏è Engineering</option>
                                <option value="Science">üî¨ Science</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="copies">
                                <i class="fas fa-copy"></i>
                                Number of Copies
                            </label>
                            <input type="number" id="copies" placeholder="5" min="1" max="100" required>
                            <small>Total copies available</small>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i>
                            Add Book to Library
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Manage Books Section -->
        <div id="manage-books-section" class="admin-section">
            <div class="section-header">
                <h1>
                    <i class="fas fa-books"></i>
                    Manage Books
                </h1>
                <p>View and manage all books in the library</p>
            </div>
            
            <div class="table-container">
                <div class="table-header">
                    <div class="search-box-admin">
                        <i class="fas fa-search"></i>
                        <input type="text" id="bookSearchInput" placeholder="Search books by title, author, or ISBN..." onkeyup="filterBooks()">
                    </div>
                    <button class="btn btn-secondary" onclick="loadBooksTable()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
                
                <div id="booksTable">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading books...</div>
                </div>
            </div>
        </div>
        
        <!-- Add Member Section -->
        <div id="add-member-section" class="admin-section">
            <div class="section-header">
                <h1>
                    <i class="fas fa-user-plus"></i>
                    Register New Member
                </h1>
                <p>Add a new member to the library system</p>
            </div>
            
            <div class="form-container">
                <form id="addMemberForm" class="admin-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="member_id">
                                <i class="fas fa-id-card"></i>
                                Member ID
                            </label>
                            <input type="text" id="member_id" placeholder="2024-EE-200" required>
                            <small>Format: YYYY-XX-###</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="member_name">
                                <i class="fas fa-user"></i>
                                Full Name
                            </label>
                            <input type="text" id="member_name" placeholder="Enter member's full name" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i>
                            Register Member
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            Reset Form
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Manage Members Section -->
        <div id="manage-members-section" class="admin-section">
            <div class="section-header">
                <h1>
                    <i class="fas fa-users-cog"></i>
                    Manage Members
                </h1>
                <p>View and manage all library members</p>
            </div>
            
            <div class="table-container">
                <div class="table-header">
                    <div class="search-box-admin">
                        <i class="fas fa-search"></i>
                        <input type="text" id="memberSearchInput" placeholder="Search members by name or ID..." onkeyup="filterMembers()">
                    </div>
                    <button class="btn btn-secondary" onclick="loadMembersTable()">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
                
                <div id="membersTable">
                    <div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading members...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.admin-dashboard {
    display: flex;
    gap: 0;
    min-height: calc(100vh - 80px);
    margin: -2rem;
}

/* Sidebar */
.admin-sidebar {
    width: 280px;
    background: var(--card-bg);
    border-right: 1px solid var(--border);
    padding: 2rem 0;
    position: sticky;
    top: 80px;
    height: calc(100vh - 80px);
    overflow-y: auto;
}

.sidebar-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0 2rem 2rem;
    border-bottom: 2px solid var(--border);
    margin-bottom: 1rem;
}

.sidebar-header i {
    font-size: 2rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.sidebar-header h3 {
    font-size: 1.3rem;
    color: var(--text-primary);
}

.sidebar-nav {
    display: flex;
    flex-direction: column;
}

.sidebar-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 2rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.3s;
    border-left: 3px solid transparent;
    font-weight: 500;
}

.sidebar-link:hover {
    background: var(--bg-tertiary);
    color: var(--primary);
    border-left-color: var(--primary);
}

.sidebar-link.active {
    background: linear-gradient(90deg, rgba(102, 126, 234, 0.1) 0%, transparent 100%);
    color: var(--primary);
    border-left-color: var(--primary);
}

.sidebar-link i {
    font-size: 1.2rem;
    width: 24px;
}

/* Main Content */
.admin-main {
    flex: 1;
    padding: 2rem;
    background: var(--bg-secondary);
    overflow-y: auto;
}

.admin-section {
    display: none;
    animation: fadeIn 0.4s;
}

.admin-section.active {
    display: block;
}

.section-header {
    margin-bottom: 2rem;
}

.section-header h1 {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 2rem;
    margin-bottom: 0.5rem;
    color: var(--text-primary);
}

.section-header p {
    color: var(--text-secondary);
    font-size: 1.1rem;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s;
    border: 1px solid var(--border);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.stat-icon {
    width: 70px;
    height: 70px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: white;
    flex-shrink: 0;
}

.stat-content h3 {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
}

.stat-content p {
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 0.5rem;
}

.stat-change {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
    padding: 0.25rem 0.75rem;
    background: var(--bg-tertiary);
    border-radius: 50px;
}

.stat-change.positive {
    color: var(--success);
    background: rgba(72, 187, 120, 0.1);
}

/* Overview Cards */
.overview-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
    margin-top: 2rem;
}

.overview-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
}

.overview-card h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    color: var(--text-primary);
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--border);
}

.category-stats {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border-radius: 10px;
}

.category-item-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.category-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
}

.category-count {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text-primary);
}

.quick-actions {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.quick-action-btn {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text-primary);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.quick-action-btn:hover {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
    transform: translateX(5px);
}

/* Form Container */
.form-container {
    background: var(--card-bg);
    padding: 2.5rem;
    border-radius: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    max-width: 900px;
}

.admin-form small {
    display: block;
    margin-top: 0.5rem;
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.form-actions .btn {
    flex: 1;
}

/* Table Container */
.table-container {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
}

.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.search-box-admin {
    position: relative;
    flex: 1;
    max-width: 500px;
}

.search-box-admin i {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

.search-box-admin input {
    width: 100%;
    padding: 0.875rem 1rem 0.875rem 3rem;
    border: 2px solid var(--border);
    border-radius: 12px;
    font-size: 1rem;
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.books-table, .members-table {
    width: 100%;
    border-collapse: collapse;
}

.books-table th, .members-table th {
    background: var(--bg-secondary);
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 2px solid var(--border);
}

.books-table td, .members-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border);
    color: var(--text-secondary);
}

.books-table tr:hover, .members-table tr:hover {
    background: var(--bg-secondary);
}

.table-badge {
    display: inline-block;
    padding: 0.4rem 0.8rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
}

.badge-available {
    background: rgba(72, 187, 120, 0.2);
    color: var(--success);
}

.badge-unavailable {
    background: rgba(245, 101, 101, 0.2);
    color: var(--danger);
}

@media (max-width: 968px) {
    .admin-dashboard {
        flex-direction: column;
    }
    
    .admin-sidebar {
        width: 100%;
        height: auto;
        position: relative;
        top: 0;
    }
    
    .sidebar-nav {
        flex-direction: row;
        overflow-x: auto;
    }
    
    .sidebar-link span {
        display: none;
    }
}
</style>

<script>
let allBooks = [];
let allMembers = [];

// Show Section
function showSection(sectionName) {
    // Update sidebar
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.classList.remove('active');
    });
    document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
    
    // Update content
    document.querySelectorAll('.admin-section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById(`${sectionName}-section`).classList.add('active');
    
    // Load data if needed
    if (sectionName === 'manage-books') {
        loadBooksTable();
    } else if (sectionName === 'manage-members') {
        loadMembersTable();
    }
}

// Load Statistics
async function loadStats() {
    try {
        const [booksRes, membersRes] = await Promise.all([
            fetch('/api/books/all'),
            fetch('/api/members/all')
        ]);
        
        const books = await booksRes.json();
        const members = await membersRes.json();
        
        allBooks = books;
        allMembers = members;
        
        const availableBooks = books.filter(b => b.available_copies > 0).length;
        const totalCopies = books.reduce((sum, b) => sum + b.available_copies, 0);
        const totalPossibleCopies = books.length * 5;
        const borrowedBooks = totalPossibleCopies - totalCopies;
        
        document.getElementById('totalBooks').textContent = books.length;
        document.getElementById('availableBooks').textContent = availableBooks;
        document.getElementById('borrowedBooks').textContent = borrowedBooks > 0 ? borrowedBooks : 0;
        document.getElementById('totalMembers').textContent = members.length;
        
        // Load category stats
        loadCategoryStats(books);
    } catch (error) {
        console.error('Error loading stats:', error);
    }
}

// Load Category Stats
function loadCategoryStats(books) {
    const categories = {
        'Novel': { icon: 'üìñ', color: '#667eea', count: 0 },
        'Programming': { icon: 'üíª', color: '#48bb78', count: 0 },
        'Engineering': { icon: '‚öôÔ∏è', color: '#4299e1', count: 0 },
        'Science': { icon: 'üî¨', color: '#f093fb', count: 0 }
    };
    
    books.forEach(book => {
        if (categories[book.category]) {
            categories[book.category].count++;
        }
    });
    
    const categoryStatsDiv = document.getElementById('categoryStats');
    categoryStatsDiv.innerHTML = Object.entries(categories).map(([name, data]) => `
        <div class="category-item">
            <div class="category-item-info">
                <div class="category-icon" style="background: ${data.color}20; color: ${data.color};">
                    ${data.icon}
                </div>
                <span style="color: var(--text-primary); font-weight: 600;">${name}</span>
            </div>
            <span class="category-count">${data.count}</span>
        </div>
    `).join('');
}

// Load Books Table
async function loadBooksTable() {
    const tableDiv = document.getElementById('booksTable');
    tableDiv.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';
    
    try {
        const response = await fetch('/api/books/all');
        allBooks = await response.json();
        
        if (allBooks.length === 0) {
            tableDiv.innerHTML = '<div class="empty-state"><i class="fas fa-book"></i><h3>No Books Found</h3></div>';
            return;
        }
        
        displayBooksTable(allBooks);
    } catch (error) {
        tableDiv.innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i><h3>Error Loading Books</h3></div>';
    }
}

function displayBooksTable(books) {
    const tableDiv = document.getElementById('booksTable');
    tableDiv.innerHTML = `
        <table class="books-table">
            <thead>
                <tr>
                    <th>ISBN</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Year</th>
                    <th>Category</th>
                    <th>Copies</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${books.map(book => `
                    <tr>
                        <td><code>${book.isbn}</code></td>
                        <td><strong>${book.title}</strong></td>
                        <td>${book.author}</td>
                        <td>${book.year}</td>
                        <td><span class="book-category">${book.category}</span></td>
                        <td>${book.available_copies}</td>
                        <td>
                            <span class="table-badge ${book.available_copies > 0 ? 'badge-available' : 'badge-unavailable'}">
                                ${book.available_copies > 0 ? 'Available' : 'Unavailable'}
                            </span>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function filterBooks() {
    const searchTerm = document.getElementById('bookSearchInput').value.toLowerCase();
    const filtered = allBooks.filter(book => 
        book.title.toLowerCase().includes(searchTerm) ||
        book.author.toLowerCase().includes(searchTerm) ||
        book.isbn.toLowerCase().includes(searchTerm)
    );
    displayBooksTable(filtered);
}

// Load Members Table
async function loadMembersTable() {
    const tableDiv = document.getElementById('membersTable');
    tableDiv.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading...</div>';
    
    try {
        const response = await fetch('/api/members/all');
        allMembers = await response.json();
        
        if (allMembers.length === 0) {
            tableDiv.innerHTML = '<div class="empty-state"><i class="fas fa-users"></i><h3>No Members Found</h3></div>';
            return;
        }
        
        displayMembersTable(allMembers);
    } catch (error) {
        tableDiv.innerHTML = '<div class="error-state"><i class="fas fa-exclamation-triangle"></i><h3>Error Loading Members</h3></div>';
    }
}

function displayMembersTable(members) {
    const tableDiv = document.getElementById('membersTable');
    tableDiv.innerHTML = `
        <table class="members-table">
            <thead>
                <tr>
                    <th>Member ID</th>
                    <th>Name</th>
                    <th>Books Borrowed</th>
                    <th>Available Slots</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${members.map(member => `
                    <tr>
                        <td><code>${member.member_id}</code></td>
                        <td><strong>${member.name}</strong></td>
                        <td>${member.borrowed_count}</td>
                        <td>${5 - member.borrowed_count}</td>
                        <td>
                            <span class="table-badge ${member.borrowed_count < 5 ? 'badge-available' : 'badge-unavailable'}">
                                ${member.borrowed_count < 5 ? 'Active' : 'Limit Reached'}
                            </span>
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}

function filterMembers() {
    const searchTerm = document.getElementById('memberSearchInput').value.toLowerCase();
    const filtered = allMembers.filter(member => 
        member.name.toLowerCase().includes(searchTerm) ||
        member.member_id.toLowerCase().includes(searchTerm)
    );
    displayMembersTable(filtered);
}

// Add Book Form
document.getElementById('addBookForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const bookData = {
        isbn: document.getElementById('isbn').value.trim(),
        title: document.getElementById('title').value.trim(),
        author: document.getElementById('author').value.trim(),
        year: document.getElementById('year').value,
        category: document.getElementById('category').value,
        copies: document.getElementById('copies').value
    };
    
    try {
        const response = await fetch('/api/books/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bookData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('üìö Book added successfully!', 'success');
            document.getElementById('addBookForm').reset();
            loadStats();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('An error occurred', 'error');
    }
});

// Add Member Form
document.getElementById('addMemberForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const memberData = {
        member_id: document.getElementById('member_id').value.trim(),
        name: document.getElementById('member_name').value.trim()
    };
    
    try {
        const response = await fetch('/api/members/add', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(memberData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            showNotification('üë§ Member registered successfully!', 'success');
            document.getElementById('addMemberForm').reset();
            loadStats();
        } else {
            showNotification(data.message, 'error');
        }
    } catch (error) {
        showNotification('An error occurred', 'error');
    }
});

// Initialize
loadStats();
</script>
{% endblock %}